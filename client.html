<!DOCTYPE html>
<html>
<head>
<title>Example Web App</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

<style type="text/css">
    body {
        width: 100%;
        height: 100%;
        background-color:white;
    }
    /* div {
        position:absolute;
        height:100%;
        width:100%;
        display: table;
    } */
    h1 {
        display: table-cell;
        vertical-align: middle;
        text-align:center;
    }

    #map {
        height: 100%;
    }

    .containerForWebOS{
        position:absolute;
        height:100%;
        width:100%;
        display:flex;
        padding: 4rem;
    }
    .leftside{
        flex: 1;
        padding: 2rem;
    }
    .rightside{
        flex: 1;
        padding: 4rem;
    }
    
</style>
<script
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtPUGjpIgxzA3D9cOCZMQYC4CJw7-_ueM&callback=initMap&libraries=&v=weekly"
defer
></script>

</head>
<body>
    <div style="position:absolute; width:100%; background-color:#539AF0; color: white; height: 4rem; padding:1rem;">
        <h1 id="txt_msg">Emergency Dashboard</h1>
    </div>

    <div class="containerForWebOS">
        <div class="leftside">
            <div id="map"></div>
        </div>
        <div class="rightside">
            <div class="card mb-3" style="max-width: 540px;">
                <div class="row no-gutters">
                  <div class="col-md-4">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcQnT7v5DUNWXTOZ4I7SgqePF9ANSX3LrpF9aA&usqp=CAU" class="card-img" alt="...">
                  </div>
                  <div class="col-md-8">
                    <div class="card-body">
                      <h5 class="card-title" id="device_id">No info</h5>
                      <p class="card-text" id="send_date"></p>
                    </div>
                  </div>
                </div>
              </div>
            
            <div class="monitor">
                <h1>CCTV</h1>
                <button id="t_left" onclick="turnCCTV(0)" class="btn btn-primary">Turn Left</button>
                <button id="t_right" onclick="turnCCTV(1)" class="btn btn-primary">Turn Right</button>
                <hr>
                <iframe id="cctv" src="" frameborder="0" width="720px" height="480px"></iframe>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
    <script>

    let map;

    function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -34.397, lng: 150.644 },
        zoom: 18
    });
    }
    var socket = io('http://13.124.113.190:8080');
    socket.on('connect', function(){
        console.log("connected");
    });
    socket.on('sendGPS', function(data){
        console.log(data);
        var lat = data['data']['lat'];
        var lng = data['data']['lng'];
        
        var inner = "";
        var date = new Date();
        inner += "request time: " + date.toString();
        document.getElementById("send_date").innerText = inner;  
        inner = "";
        inner += "device_id : " + data['data']['device_id'];
        document.getElementById("device_id").innerText = inner;  

        var location = {lat: data['data'], lng: lng};
        var center = new google.maps.LatLng(lat, lng);

        // The marker
        var marker = new google.maps.Marker({position: center, map: map});

        // using global variable:
        map.panTo(center);

        var cctv = document.getElementById("cctv");
        cctv.setAttribute("src", "http://192.168.137.43:8081");
    });
    socket.on('disconnect', function(){
        console.log("disconnected");
    });

    function turnCCTV(turn){
        socket.emit('turnCCTV', turn, (data) => {
            console.log("send" + data); // data will be 'woot'
        });
        
        socket.broadcast.emit("sendGPS", {data: req}, (data)=>{
            console.log("send" + data); // data will be 'woot'

        });

    }

    
    </script>
</body>
</html>
